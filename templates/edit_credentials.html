<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Credentials</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f0f2f5, #a8b9d9);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px 15px;
      color: #2c3e50;
    }

    .container {
      background: #fff;
      max-width: 460px;
      width: 100%;
      border-radius: 20px;
      padding: 48px 50px 52px;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.15);
      position: relative;
      user-select: none;
    }

    a.back-arrow {
      position: absolute;
      top: 25px;
      left: 25px;
      font-weight: 600;
      color: #4a6eda;
      text-decoration: none;
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: rgba(74, 110, 218, 0.1);
      border-radius: 30px;
      box-shadow: 0 6px 18px rgba(74, 110, 218, 0.25);
      transition: background-color 0.3s ease, color 0.3s ease, transform 0.25s ease;
      user-select: none;
      z-index: 10;
    }
    a.back-arrow:hover,
    a.back-arrow:focus {
      background-color: #4a6eda;
      color: #fff;
      outline: none;
      transform: translateX(-5px);
      box-shadow: 0 8px 22px rgba(74, 110, 218, 0.5);
      cursor: pointer;
    }
    .back-arrow-chevron {
      font-weight: 700;
      font-size: 1.5rem;
      line-height: 1;
    }

    h2 {
      margin: 0 0 36px 0;
      font-weight: 700;
      font-size: 2.1rem;
      color: #334e9e;
      text-align: center;
      user-select: text;
      text-shadow: 0 3px 6px rgba(74, 110, 218, 0.35);
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 26px;
      user-select: text;
    }

    label {
      display: block;
      font-weight: 600;
      color: #4564c7;
      margin-bottom: 10px;
      font-size: 1.1rem;
      user-select: text;
    }

    input[type="password"],
    input[type="text"] {
      width: 100%;
      padding: 14px 18px;
      font-size: 1rem;
      border-radius: 10px;
      border: 2.5px solid #cbd3ec;
      font-family: 'Poppins', sans-serif;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      box-sizing: border-box;
      color: #2c3e50;
      font-weight: 500;
      user-select: text;
    }

    input[type="password"]:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: #4a6eda;
      box-shadow: 0 0 10px rgba(74, 110, 218, 0.5);
      background-color: #f7f9ff;
    }

    input.invalid {
      border-color: #e53e3e;
      background-color: #ffeded;
      box-shadow: 0 0 10px rgba(229, 62, 62, 0.5);
    }

    button {
      margin-top: 12px;
      background-color: #4a6eda;
      color: white;
      font-weight: 700;
      font-size: 1.2rem;
      padding: 16px 0;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(74, 110, 218, 0.7);
      user-select: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    button:hover,
    button:focus {
      background-color: #3759b2;
      box-shadow: 0 12px 30px rgba(55, 89, 178, 0.8);
      outline: none;
    }

    .form-group {
      user-select: text;
    }

    .password-requirements {
      margin-top: 10px;
      font-size: 0.9rem;
      line-height: 1.5;
      color: #6173c9;
      background: #ecf0ff;
      padding: 14px 18px;
      border-radius: 12px;
      box-shadow: inset 0 0 10px rgba(74, 110, 218, 0.15);
      user-select: text;
    }

    .password-requirements strong {
      font-weight: 700;
      color: #4a6eda;
    }

    .toggle-password {
      display: inline-block;
      margin-top: 8px;
      font-size: 0.9rem;
      color: #4a6eda;
      cursor: pointer;
      user-select: none;
      transition: color 0.3s ease;
      user-select: none;
    }
    .toggle-password:hover,
    .toggle-password:focus {
      color: #3759b2;
      outline: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/home" class="back-arrow" aria-label="Back to Home">
      <span class="back-arrow-chevron" aria-hidden="true">&#x2039;</span> Back
    </a>

    <h2>Edit Credentials</h2>

    {% if not verified %}
    <form method="POST" novalidate>
      <div class="form-group">
        <label for="current_password">Current Password:</label>
        <input type="password" id="current_password" name="current_password" required autocomplete="current-password" />
      </div>
      <button type="submit">Verify</button>
    </form>
    {% else %}
    <form method="POST" novalidate>
      <div class="form-group">
        <label for="new_username">New Username:</label>
        <input type="text" id="new_username" name="new_username" value="{{ username }}" autocomplete="username" />
      </div>
      <div class="form-group">
        <label for="new_password">New Password:</label>
        <input type="password" id="new_password" name="new_password" required autocomplete="new-password" />
        <span class="toggle-password" role="button" tabindex="0" aria-pressed="false" onclick="togglePassword()" onkeydown="if(event.key==='Enter' || event.key===' ') togglePassword();">
          Show Password
        </span>
        <p class="password-requirements" id="requirements">
          <strong>Password must contain:</strong><br />
          - At least 6 characters<br />
          - At least one number (0-9)<br />
          - At least one symbol (!@#$%^&*)<br />
          - At least one uppercase letter (A-Z)<br />
          - At least one lowercase letter (a-z)
        </p>
      </div>
      <div class="form-group">
        <label for="confirm_password">Confirm New Password:</label>
        <input type="password" id="confirm_password" name="confirm_password" required autocomplete="new-password" />
      </div>
      <button type="submit">Update</button>
    </form>
    {% endif %}
  </div>

  <script>
    const newPasswordInput = document.getElementById("new_password");
    const confirmPasswordInput = document.getElementById("confirm_password");

    if (newPasswordInput && confirmPasswordInput) {
      const updateForm = newPasswordInput.closest('form');

      if (updateForm) {
        updateForm.addEventListener("submit", function(e) {
          const newPasswordValue = newPasswordInput.value;
          const confirmPasswordValue = confirmPasswordInput.value;

          const conditions = [
            newPasswordValue.length >= 6,
            /[0-9]/.test(newPasswordValue),
            /[!@#$%^&*]/.test(newPasswordValue),
            /[A-Z]/.test(newPasswordValue),
            /[a-z]/.test(newPasswordValue)
          ];

          if (!conditions.every(c => c)) {
            e.preventDefault();
            alert("Password does not meet requirements.");
            newPasswordInput.classList.add("invalid");
            confirmPasswordInput.classList.remove("invalid");
          } else if (newPasswordValue !== confirmPasswordValue) {
            e.preventDefault();
            alert("Passwords do not match.");
            confirmPasswordInput.classList.add("invalid");
          }
        });

        newPasswordInput.addEventListener("input", () => {
          newPasswordInput.classList.remove("invalid");
        });

        confirmPasswordInput.addEventListener("input", () => {
          confirmPasswordInput.classList.remove("invalid");
        });
      }
    }

    function togglePassword() {
      const passwordInput = document.getElementById("new_password");
      const toggle = document.querySelector(".toggle-password");
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        toggle.textContent = "Hide Password";
        toggle.setAttribute("aria-pressed", "true");
      } else {
        passwordInput.type = "password";
        toggle.textContent = "Show Password";
        toggle.setAttribute("aria-pressed", "false");
      }
    }
  </script>
  <footer style="text-align: center; padding: 20px; color: gray; font-size: 18px; font-weight: bold;">
    Developed by Kaniskten grade 8 Advaita international school
     
</footer>
    <footer style="text-align: center; padding: 20px; color: gray; font-size: 16px; font-weight: bold;">
    Â© 2025 Kaniskten Programming. All rights reserved.
</footer>
</body>

</html>
